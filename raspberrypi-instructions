Install Raspberry Pi OS (Lite) using the Raspberry Pi Imager here:
https://www.raspberrypi.org/downloads.../

On the SD card before first boot:
  1. Enable SSH:
    In /boot/ create named "ssh" with no extension (in Windows, create a new text file called ssh.txt and then rename to remove the extension)
  2. Disable the Raspberry Pi Camera LED (we don't want to scare off the birds!):
    In /boot/config.txt:
    Add the following line to the end of the file, then save it.
    disable_camera_led=1
  3. Turn on the Wifi:
     Create a new file called "wpa_supplicant.conf"
     In this file, you will have to type in the required configuration to connect to the Wi-Fi network.  Just create a new file wpa_supplicant.conf and add the following lines to it. Be sure to make changes where necessary depending on your configuration. Finally, save the file.
      country=NZ
      ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=netdev
      update_config=1

      network={
        ssid="WIFI_SSID"
        scan_ssid=1
        psk="WIFI_PASSWORD"
        key_mgmt=WPA-PSK
      }


On first boot:

  sudo apt update
  sudo apt upgrade

  sudo raspi-config
    Enable Legacy Camera
    Enable I2C
    Add Timezone
    Change default password
    Change hostname
    Set GPU memory to 64
    
  Install packages:
    sudo apt install git python3-pip
    sudo apt install libssl1.0.2
    
    curl https://packages.microsoft.com/config/debian/11/prod.list > ./microsoft-prod.list
    sudo cp ./microsoft-prod.list /etc/apt/sources.list.d/
    
    curl https://packages.microsoft.com/config/debian/stretch/multiarch/prod.list > ./microsoft-prod-old.list
    sudo cp ./microsoft-prod-old.list /etc/apt/sources.list.d/
    
    curl https://packages.microsoft.com/keys/microsoft.asc | gpg --dearmor > microsoft.gpg
    sudo cp ./microsoft.gpg /etc/apt/trusted.gpg.d/
    
    sudo apt update
    sudo apt install moby-engine
    sudo apt install iotedge
    
    sudo vi /etc/docker/daemon.json
      Add the following lines:
        {
          "dns": ["1.1.1.1"]
        }
  
    Add the Azure IOT Device Primary Key
    sudo vi /etc/iotedge/config.yaml
    
    
    sudo systemctl restart iotedge
    systemctl status iotedge
    sudo iotedge check

     
    sudo apt install cmake liblog4cpp5-dev libv4l-dev git
    git clone https://github.com/mpromonet/v4l2rtspserver.git ; cd v4l2rtspserver/ ; cmake . ; make ; sudo make install
    
    sudo vi /etc/rc.local
    Add the following lines before the Exit line to rotate the camera image 180deg 
      v4l2-ctl --set-ctrl vertical_flip=1
      v4l2-ctl --set-ctrl horizontal_flip=1
    
    sudo vi /lib/systemd/system/v4l2rtspserver.service
    We need to edit the ExecStart line. After editing the line should look something like this.
    ExecStart=v4l2rtspserver -W 640 -H 480 -F 15 -P 8554 -U tui:password /dev/video0
    
    sudo modprobe -v bcm2835-v4l2
    
    sudo systemctl enable v4l2rtspserver
    
    bash -c "$(curl -sL https://aka.ms/ava-edge/prep_device)"
    
    sudo reboot
    
    
    
    pi@tuitracker1:~ $ sudo iotedge list
NAME                        STATUS           DESCRIPTION      CONFIG
SimulatedTemperatureSensor  running          Up 3 minutes     mcr.microsoft.com/azureiotedge-simulated-temperature-sensor:1.0
edgeAgent                   running          Up 4 minutes     mcr.microsoft.com/azureiotedge-agent:1.1
edgeHub                     running          Up 3 minutes     mcr.microsoft.com/azureiotedge-hub:1.1
    

